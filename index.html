<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chào mừng quý khách</title>
    <style>
        body { font-family: sans-serif; text-align: center; background: #f4f4f4; padding: 20px; }
        .container { background: white; max-width: 400px; margin: 0 auto; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h2 { color: #333; }
        
        /* Khung video responsive */
        .video-container {
            position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; margin-bottom: 20px;
        }
        .video-container iframe {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        }

        /* Nút kết nối (ban đầu ẩn đi) */
        #connectBtn {
            display: none; /* Ẩn nút lúc đầu */
            background: #28a745; color: white; border: none;
            padding: 15px 30px; font-size: 18px; border-radius: 5px;
            cursor: pointer; width: 100%;
        }
        #connectBtn:hover { background: #218838; }
        .timer { color: #666; font-size: 14px; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h2>Vui lòng xem Video để kết nối WiFi</h2>
    
    <div class="video-container">
    <iframe width="560" height="315" 
        /* CHÚ Ý: Dòng dưới đây thêm ?autoplay=1&mute=1 */
        src="https://www.youtube.com/watch?v=OEfP4rdmhMU?autoplay=1&mute=1&controls=1&rel=0" 
        title="YouTube video player" 
        frameborder="0" 
        /* Thêm thuộc tính allow autoplay */
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
        allowfullscreen>
    </iframe>
</div>
    </div>

    <div class="timer" id="message">Nút kết nối sẽ hiện sau vài giây...</div>

    <form id="loginForm" method="POST">
        <input type="hidden" name="username" value="wifi">
        <input type="hidden" name="password" value="1234">
        
        <input type="hidden" name="clientMac" id="clientMac">
        <input type="hidden" name="apMac" id="apMac">
        <input type="hidden" name="gatewayMac" id="gatewayMac">
        <input type="hidden" name="vid" id="vid">
        
        <button type="button" id="connectBtn" onclick="submitLogin()">KẾT NỐI INTERNET NGAY</button>
    </form>
</div>

<script>
    // 1. Cấu hình thời gian chờ (Giây)
    const waitTime = 10; 

    // 2. Logic đếm ngược và hiện nút
    setTimeout(function() {
        document.getElementById('connectBtn').style.display = 'block';
        document.getElementById('message').style.display = 'none';
    }, waitTime * 1000);

    // 3. Logic xử lý Link Router
    document.addEventListener("DOMContentLoaded", function() {
        const params = new URLSearchParams(window.location.search);
        
        // Lấy các tham số từ URL Router gửi sang gán vào form
        if(params.get('clientMac')) document.getElementById('clientMac').value = params.get('clientMac');
        if(params.get('apMac')) document.getElementById('apMac').value = params.get('apMac');
        if(params.get('gatewayMac')) document.getElementById('gatewayMac').value = params.get('gatewayMac');
        if(params.get('vid')) document.getElementById('vid').value = params.get('vid');

        // Xác định đích đến (Target URL) để submit form
        // TP-Link Standalone thường gửi về biến 'target'
        let targetUrl = params.get('target');
        
        // Nếu không có target, thử dùng cấu trúc mặc định của TP-Link
        if (!targetUrl) {
            // Mẹo: Nếu router gửi kèm Gateway IP
            const gatewayIP = params.get('gatewayAddress') || params.get('ip'); 
            if (gatewayIP) {
                targetUrl = "http://" + gatewayIP + "/portal/auth";
            } else {
                // Đường dẫn mặc định của nhiều dòng TP-Link Router
                targetUrl = "/portal/auth"; 
            }
        }
        
        const form = document.getElementById('loginForm');
        form.action = targetUrl;
    });

    function submitLogin() {
        document.getElementById('loginForm').submit();
    }
</script>

</body>
</html>

